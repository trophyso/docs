---
title: Building a Fitness Tracker
description: Learn how to build a Strava-like fitness app with Next.js, featuring multi-sport tracking, city-based leaderboards, and normalized XP progression.
subtitle: Build a high-retention fitness app with streaks and leaderboards.
---

In this tutorial, we'll build **TrophyFitness**, a consumer fitness application that tracks running, cycling, and swimming. We'll implement a complete gamification loop including weekly leaderboards, habit-forming streaks, and a leveled progression system.

If you want to skip straight to the code, check out the [example repository](https://github.com/trophyso/example-fitness-platform).

<Frame>
  {/* Placeholder for demo video */}
  <div className="w-full aspect-video bg-muted flex items-center justify-center rounded-lg border border-border">
    <span className="text-muted-foreground">Demo Video Coming Soon</span>
  </div>
</Frame>

## Table of Contents

- [Tech Stack](#tech-stack)
- [Prerequisites](#prerequisites)
- [Setup & Installation](#setup--installation)
- [Designing the Data Model](#designing-the-data-model)
- [Server Actions](#server-actions)
- [Building the Dashboard](#building-the-dashboard)
- [Implementing Leaderboards](#implementing-leaderboards)
- [The Result](#the-result)

## Tech Stack

- **Framework:** [Next.js 15](https://nextjs.org) (App Router)
- **UI:** [Shadcn/UI](https://ui.shadcn.com) + TailwindCSS
- **Icons:** [Lucide React](https://lucide.dev)
- **Gamification:** [Trophy](https://trophy.so)

## Prerequisites

- A Trophy account (sign up [here](https://app.trophy.so/sign-up)).
- Node.js 18+ installed.

## Setup & Installation

First, clone the starter repository or create a new Next.js app:

```bash
npx create-next-app@latest trophy-fitness
```

Install the required dependencies:

```bash
npm install @trophyso/node lucide-react clsx tailwind-merge
```

Configure your environment variables in `.env.local`:

```bash
TROPHY_API_KEY=your_api_key_here
```

## Designing the Data Model

For a multi-sport fitness app, we need to normalize efforts. A 10km cycle is not the same as a 10km run. We'll use three distinct metrics to track raw data, and a unified XP system for progression.

### 1. The Metrics
We will track distance as the primary value.

*   `distance_run` (km) - with `pace` attribute (walk/run).
*   `distance_cycled` (km)
*   `distance_swum` (m) - with `style` attribute (freestyle/breaststroke).

### 2. The Attributes
To enable local leaderboards, we'll tag every user with a `city` attribute.

## Server Actions

We'll create a `src/app/actions.ts` file to handle all interactions with the Trophy API. This keeps our API keys secure and allows us to leverage Next.js Server Actions.

```tsx src/app/actions.ts [expandable]
"use server";

import { TrophyApiClient } from "@trophyso/node";
import { revalidatePath } from "next/cache";

const trophy = new TrophyApiClient({
  apiKey: process.env.TROPHY_API_KEY as string,
});

export async function getUserStats(userId: string) {
  try {
    const [streak, achievements, pointsResponse] = await Promise.all([
      trophy.users.streak(userId).catch(() => null),
      trophy.users.achievements(userId, { includeIncomplete: "true" }).catch(() => []),
      // Points system handles the normalization of XP across sports
      trophy.users.points(userId, "xp").catch(() => null),
    ]);

    return { streak, achievements, points: pointsResponse };
  } catch (error) {
    console.error("Failed to fetch user stats:", error);
    return null;
  }
}

export async function logActivity(params: {
  type: "run" | "cycle" | "swim";
  distance: number;
  userId: string;
  city?: string;
  pace?: string;
  style?: string;
}) {
  const { type, distance, userId, city, pace, style } = params;
  
  let metricKey = "";
  const eventAttributes: Record<string, string> = {};

  switch (type) {
    case "run": 
      metricKey = "distance_run"; 
      if (pace) eventAttributes.pace = pace;
      break;
    case "cycle": 
      metricKey = "distance_cycled"; 
      break;
    case "swim": 
      metricKey = "distance_swum"; 
      if (style) eventAttributes.style = style;
      break;
  }

  // Update the user's city attribute while logging the event
  // to ensure leaderboards are correctly filtered.
  await trophy.metrics.event(metricKey, {
    user: { 
      id: userId,
      ...(city ? { attributes: { city } } : {})
    },
    value: distance,
    ...(Object.keys(eventAttributes).length > 0 ? { attributes: eventAttributes } : {}),
  });

  revalidatePath("/");
  revalidatePath("/leaderboards");
}

export async function getLeaderboard(leaderboardKey: string, city?: string) {
  const response = await trophy.leaderboards.get(leaderboardKey, {
    userAttributes: city ? `city:${city}` : undefined,
  });
  return response.rankings;
}
```

## Building the Dashboard

The dashboard is the player's home base. It shows their current streak, XP level, and recent activity.

We'll create a main page that fetches stats server-side and renders them.

```tsx src/app/page.tsx [expandable]
import { getUserStats } from "./actions";
import { Flame, Trophy } from "lucide-react";
import { Progress } from "@/components/ui/progress";

export default async function Dashboard() {
  // In a real app, you would get the current user ID from your auth provider
  const userId = "user_123"; 
  const stats = await getUserStats(userId);
  
  const streakLength = stats?.streak?.length ?? 0;
  const totalPoints = stats?.points?.total ?? 0;
  
  // Trophy Points objects return the current level and the points 
  // required for the next level automatically.
  const currentLevel = stats?.points?.level?.name ?? "Rookie";
  const nextLevelPoints = stats?.points?.nextLevelPoints ?? 1000;
  const progressPercent = (totalPoints / nextLevelPoints) * 100;

  return (
    <div className="p-6 max-w-md mx-auto space-y-6">
      {/* XP & Level Card */}
      <div className="bg-card border rounded-xl p-4 space-y-3">
        <div className="flex justify-between items-baseline">
          <h2 className="font-bold text-lg">Level {currentLevel}</h2>
          <span className="text-sm text-muted-foreground">{totalPoints} XP</span>
        </div>
        <Progress value={progressPercent} className="h-2" />
        <p className="text-xs text-muted-foreground">
          {nextLevelPoints - totalPoints} XP until next level
        </p>
      </div>

      {/* Streak Card */}
      <div className="bg-orange-50 border border-orange-100 rounded-xl p-4 flex items-center gap-4">
        <div className="bg-orange-100 p-3 rounded-full">
          <Flame className="w-6 h-6 text-orange-500 fill-orange-500" />
        </div>
        <div>
          <div className="font-bold text-2xl">{streakLength}</div>
          <div className="text-sm text-orange-600 font-medium">Day Streak</div>
        </div>
      </div>
    </div>
  );
}
```

## Implementing Leaderboards

Competition drives engagement. We'll build a leaderboard page that lets users toggle between "Global" and "Local" (City) views.

Ensure you have configured separate leaderboard keys in the Trophy Dashboard for global and filtered views (e.g., `weekly-run` and `weekly-run-cities`).

```tsx src/app/leaderboards/page.tsx [expandable]
"use client";

import { useState, useEffect } from "react";
import { getLeaderboard } from "@/app/actions";
import { Trophy } from "lucide-react";

export default function LeaderboardPage() {
  const [scope, setScope] = useState<"global" | "city">("global");
  const [data, setData] = useState([]);

  useEffect(() => {
    // Determine the correct leaderboard key based on scope
    const key = scope === "city" ? "weekly-run-cities" : "weekly-run";
    const city = scope === "city" ? "London" : undefined;
    
    getLeaderboard(key, city).then(setData);
  }, [scope]);

  return (
    <div className="p-6 max-w-md mx-auto">
      <div className="flex gap-2 mb-6">
        <button 
          onClick={() => setScope("global")}
          className={`px-4 py-2 rounded-lg ${scope === "global" ? "bg-primary text-white shadow" : "bg-gray-100"}`}
        >
          Global
        </button>
        <button 
          onClick={() => setScope("city")}
          className={`px-4 py-2 rounded-lg ${scope === "city" ? "bg-primary text-white shadow" : "bg-gray-100"}`}
        >
          Local
        </button>
      </div>

      <div className="space-y-3">
        {data.map((entry: any, index) => (
          <div key={entry.userId} className="flex items-center gap-4 p-4 border rounded-xl bg-card">
            <div className={`font-bold w-6 ${index < 3 ? "text-primary" : "text-muted-foreground"}`}>
              {index + 1}
            </div>
            <div className="flex-1 font-medium">{entry.userName || `User ${entry.userId.slice(0,5)}`}</div>
            <div className="font-bold">{entry.value.toLocaleString()} km</div>
            {index < 3 && <Trophy className="w-4 h-4 text-yellow-500" />}
          </div>
        ))}
      </div>
    </div>
  );
}
```

## Adding Progression (XP & Levels)

To compare athletes across different sports, we use a normalized XP system.

*   **Run:** 10 XP / km
*   **Cycle:** 3 XP / km
*   **Swim:** 10 XP / 100m

In Trophy, you configure a **Points System** with the key `xp`. You then create **Triggers** for each metric:
1.  **Metric:** `distance_run` → **Award:** 10 Points per 1 unit.
2.  **Metric:** `distance_cycled` → **Award:** 3 Points per 1 unit.
3.  **Metric:** `distance_swum` → **Award:** 10 Points per 100 units (since swimming is tracked in meters).

Trophy automatically aggregates these into a single `total` for the user and maps them to your defined **Levels** (e.g., Level 1: 0 XP, Level 2: 500 XP). Your frontend code simply reads `stats.points.total` and `stats.points.level.name`.

## The Result

You now have a fully functional fitness gamification loop! Users can log workouts, compete in local leagues, and level up their global athlete profile.

<Frame>
  <img src="/images/fitness-app-demo.png" alt="Fitness App Demo" className="rounded-xl border" />
</Frame>
